(function(t){function e(e){for(var a,r,c=e[0],o=e[1],u=e[2],d=0,f=[];d<c.length;d++)r=c[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&f.push(n[r][0]),n[r]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);l&&l(e);while(f.length)f.shift()();return s.push.apply(s,u||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],a=!0,c=1;c<i.length;c++){var o=i[c];0!==n[o]&&(a=!1)}a&&(s.splice(e--,1),t=r(r.s=i[0]))}return t}var a={},n={app:0},s=[];function r(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=a,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(i,a,function(e){return t[e]}.bind(null,a));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var u=0;u<c.length;u++)e(c[u]);var l=o;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var a=i("85ec"),n=i.n(a);n.a},"3e42":function(t,e,i){},"4c20":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("8bbf"),n=i.n(a),s=i("a65d"),r=i.n(s),c=i("afa7"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},u=[],l=(i("034f"),i("2877")),d={},f=Object(l["a"])(d,o,u,!1,null,null,null),v=f.exports,m=i("8c4f"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.token?i("upload-form",{on:{insertNewActivity:t.insertNewActivity}}):t._e(),t.activities.length?i("div",{attrs:{id:"activities"}},t._l(t.activities,(function(e){return i("div",{key:e.id,staticClass:"activity-item"},[i("div",{staticClass:"mod"},[i("div",{staticClass:"hd"},[i("div",{staticClass:"avatar"},[i("a",{attrs:{href:"javascript:void(0);",title:"dd"}},[e.user.avatar?i("img",{attrs:{src:e.user.avatar,alt:e.user.name}}):t._e()])]),i("div",{staticClass:"text"},[i("a",{staticClass:"bold",attrs:{href:"javascript:void(0);"}},[t._v(t._s(e.user.name))]),t._v(t._s(e.action)+": "),i("div",{staticClass:"content"},[i("div",{staticClass:"html",domProps:{innerHTML:t._s(e.target.html_content)}})])])]),i("div",{staticClass:"bd"},[e.attachments.length&&0==e.layout?i("div",{staticClass:"lnk"},t._l(e.attachments,(function(e,a){return i("div",{key:a,staticClass:"blockquote"},[i("div",{staticClass:"title"},[i("a",{attrs:{href:e.url,target:"_blank"}},[t._v(t._s(e.title))])]),i("p",[t._v(t._s(e.abstract))])])})),0):e.attachments.length&&1==e.layout?i("div",{staticClass:"pics",class:{"pics-big":e.big},on:{click:function(i){return t.toggleActivitySize(e)}}},t._l(e.attachments,(function(t,e){return i("div",{key:e,staticClass:"pic"},[i("img",{attrs:{src:t.url}})])})),0):e.attachments.length&&2==e.layout?i("div",{staticClass:"videos"},t._l(e.attachments,(function(a,n){return i("div",{key:n,staticClass:"video",class:{"video-big":e.big},style:{width:172*a.size[0]*(e.big?2:1)/a.size[1]+"px"},on:{click:function(i){return t.toggleActivitySize(e)}}},[i("vue-plyr",{staticClass:"screen"},[i("video",{attrs:{poster:a.cover_url}},[i("source",{attrs:{src:a.url,type:"video/mp4"}})]),i("i",{staticClass:"iconfont icon-ziyuan video-overlay"})])],1)})),0):t._e(),i("div",{staticClass:"actions"},[i("span",{staticClass:"time",attrs:{title:t.moment(e.created_at).format("YYYY-MM-D HH:mm:ss")}},[i("a",{attrs:{href:e.target.url||"javascript:void(0);"}},[t._v(" "+t._s(t.moment(e.created_at).fromNow()))])]),e.can_comment?i("a",{staticClass:"btn reply",attrs:{href:"javascript:void(0);"},on:{click:function(i){return t.toggleShowComments(e)}}},[t._v(t._s(e.showComments?" 隐藏":e.n_comments||"")+"评论")]):t._e(),i("a",{staticClass:"btn heart",class:{liked:e.liked},attrs:{href:"javascript:void(0);"},on:{click:function(i){return t.react(e)}}},[t._v(t._s(e.liked?"已":"")+"赞"+t._s(0==e.n_likes?"":"("+e.n_likes+")"))])]),e.showComments?i("div",{staticClass:"comments"},[i("div",{staticClass:"comments-items"},t._l(e.comments,(function(a,n){return i("div",{key:n,staticClass:"comment-item",on:{mouseover:function(t){a.showReply=!0},mouseleave:function(t){a.showReply=!1}}},[i("span",{staticClass:"comment-item-content"},[t._v(t._s(a.content))]),i("i",{staticClass:"comment-item-spliter"},[t._v("-")]),i("a",{staticClass:"comment-item-author",attrs:{href:a.user.link}},[t._v(t._s(a.user.username))]),a.showReply?i("div",{staticClass:"comment-item-action"},[i("a",{staticClass:"reply",on:{click:function(i){return t.reply(e,a)}}},[t._v("回复")])]):t._e()])})),0),i("form",{staticClass:"comment-reply",on:{submit:function(i){return i.preventDefault(),t.commentTo(e)}}},[i("div",{staticClass:"comment-text"},[i("span",{staticClass:"reply-target"},[t._v(t._s(t.replyTo))]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.commentContent,expression:"commentContent"}],staticClass:"reply-input",attrs:{type:"text",maxlength:"280",autocomplete:"off"},domProps:{value:t.commentContent},on:{input:function(e){e.target.composing||(t.commentContent=e.target.value)}}})]),i("button",{staticClass:"comment-btn",attrs:{type:"submit"}},[t._v("发表回应")])])]):t._e()])])])})),0):t._e(),i("paginator",{attrs:{total:t.total,page:t.page}}),i("div",{attrs:{id:"aside"}})],1)},h=[],b=(i("99af"),i("d81d"),i("1393"),i("d4ec")),_=i("bee2"),g=i("99de"),w=i("7e84"),y=i("257e"),C=i("262e"),O=i("ade3"),E=i("c32d"),V=i.n(E),j=i("2fe1"),k=i("a78e"),S=i.n(k),L="Lyanna-Token",A=1/24;function I(){return S.a.get(L)}function x(t){return S.a.set(L,t,{expires:A})}function T(){return S.a.remove(L)}var D=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"form"}},[i("div",{staticClass:"create-activity",class:{active:t.OnFocus}},[i("form",{staticClass:"create-form",attrs:{name:"form"},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[i("ul",{staticClass:"activity-tab"},[i("li",{staticClass:"status",class:{active:1==t.activeLi},on:{click:function(e){return t.activate(1)}}},[t._m(0)]),i("li",{staticClass:"pic",class:{active:2==t.activeLi},on:{click:function(e){return t.activate(2)}}},[t._m(1)]),i("li",{staticClass:"video",class:{active:3==t.activeLi},on:{click:function(e){return t.activate(3)}}},[t._m(2)]),i("li",{staticClass:"link",class:{active:4==t.activeLi},on:{click:function(e){return t.activate(4)}}},[t._m(3)])]),4==t.activeLi?i("div",{staticClass:"field link-act"},[t.urlInfo?i("div",{staticClass:"hd"},[i("p",[t._v(t._s(this.urlInfo.title))])]):t._e(),i("div",{staticClass:"bd"},[t.urlError?i("div",{staticClass:"error"},[i("span",[t._v(t._s(this.urlError))]),i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.urlError=""}}},[t._v("重新输入")])]):t._e(),t.urlError||t.urlLoading||t.urlInfo?t._e():i("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"link-text",attrs:{type:"text",value:"http://",name:"url"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),t.urlError||t.urlLoading||t.urlInfo?t._e():i("input",{staticClass:"input-link",attrs:{type:"button",value:"输入网址",disabled:!t.url},on:{click:t.getLinkInfo}}),t.urlLoading?i("p",[t._v("正在获取网址信息...")]):t._e(),t.urlInfo?i("p",[t._v(t._s(this.urlInfo.abstract))]):t._e()]),t.urlInfo?i("a",{staticClass:"link-cancel",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.urlInfo=null}}},[t._v("×")]):t._e()]):t._e(),i("div",{staticClass:"activity-content"},[t.OnFocus||t.text?t._e():i("label",{attrs:{id:"label",for:"text"}},[t._v("分享我的动态...")]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],style:{height:t.textAreaHeight+"px"},attrs:{id:"text",name:"text",rows:"1"},domProps:{value:t.text},on:{focus:function(e){t.OnFocus=!0},input:function(e){e.target.composing||(t.text=e.target.value)}}})]),[2,3].includes(t.activeLi)?i("div",{staticClass:"upload-form"},[t.files.length?t._e():i("file-upload",{ref:"upload",staticClass:"upload",attrs:{"custom-action":t.customAction,"post-action":"/api/upload",multiple:!0,size:52428800,drop:!0,"drop-directory":!0},on:{"input-file":t.inputFile,"input-filter":t.inputFilter},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}}),i("div",{staticClass:"bd"},[t.files.length?i("ul",{staticClass:"file-list"},[t._l(t.files,(function(e){return i("li",{key:e.id,staticClass:"file-item"},[e.thumb?i("img",{staticClass:"thumb",attrs:{src:e.thumb}}):i("a",{attrs:{title:e.name}},[i("img",{staticClass:"thumb",attrs:{src:t.getCover(e)}}),i("i",{staticClass:"iconfont icon-ziyuan player-btn"})]),i("a",{staticClass:"lnk-remove-photo",attrs:{href:"#"},on:{click:function(i){return t.removeFile(e)}}},[t._v("×")])])})),i("li",{staticClass:"file-item add-photo"},[i("i",[t._v("+")]),t.files.length?i("file-upload",{ref:"upload",staticClass:"file-upload",attrs:{"custom-action":t.customAction,"post-action":"/api/upload",multiple:!0,size:52428800,drop:!0,"drop-directory":!0},on:{"input-file":t.inputFile,"input-filter":t.inputFilter},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}}):t._e()],1)],2):i("div",{staticClass:"upload-section"},[t._m(4),i("a",{staticClass:"upload-btn",attrs:{href:"javascript: void 0;"}},[i("i",{staticClass:"iconfont icon-big",class:{"icon-photoadd":2==t.activeLi,"icon-video_add":3==t.activeLi}}),i("span",{staticClass:"upload-info"},[t._v("上传"+t._s(2==t.activeLi?"照片":"视频"))])])])])],1):t._e(),t.OnFocus||1!=t.activeLi?i("div",{staticClass:"btn"},[i("button",{staticClass:"pure-button activity-btn",attrs:{type:"submit"}},[t._v("发布")])]):t._e()]),1==t.activeLi?i("div",{staticClass:"pure-button-group btn-group"},[t.files.length?t._e():i("file-upload",{ref:"upload",staticClass:"file-upload-btn",attrs:{"custom-action":t.customAction,"post-action":"/api/upload",multiple:!0,size:52428800,drop:!0,"drop-directory":!0},on:{"input-file":t.inputFile,"input-filter":t.inputFilter},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}}),t.showIcon?i("a",{staticClass:"iconfont icon-photo1",attrs:{href:"javascript:void(0);",title:"上传照片"}},[i("span",{staticClass:"ico"},[t._v("照片")])]):t._e(),t.showIcon?i("a",{staticClass:"iconfont icon-video1",attrs:{href:"javascript:void(0);",title:"上传视频"}},[i("span",{staticClass:"ico"},[t._v("视频")])]):t._e()],1):t._e()])])},P=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",{attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"iconfont icon-dongtai icon-right"}),i("span",[t._v("发动态")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",{attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"iconfont icon-photo icon-right"}),i("span",[t._v("发照片")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",{attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"iconfont icon-video icon-right"}),i("span",[t._v("发视频")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",{attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"iconfont icon-link icon-right"}),i("span",[t._v("推荐网页")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"drag-tip"},[i("i",{staticClass:"iconfont icon-Drag-Drop icon-right"}),t._v("拖文件到框里上传")])}],R=(i("b0c0"),i("4ec9"),i("d3b7"),i("3ca3"),i("5319"),i("1276"),i("2ca0"),i("ddb0"),i("2b3d"),i("2909")),$=(i("96cf"),i("8019")),F=i.n($),N=i("bef5"),z=i.n(N),W=i("bc3a"),H=i.n(W),U=i("2f62"),G={state:{sidebar:{opened:!S.a.get("sidebarStatus")||!!+S.a.get("sidebarStatus"),withoutAnimation:!1},device:"desktop",language:S.a.get("language")||"en",size:S.a.get("size")||"medium"},mutations:{TOGGLE_SIDEBAR:function(t){t.sidebar.opened=!t.sidebar.opened,t.sidebar.withoutAnimation=!1,t.sidebar.opened?S.a.set("sidebarStatus",1):S.a.set("sidebarStatus",0)},CLOSE_SIDEBAR:function(t,e){S.a.set("sidebarStatus",0),t.sidebar.opened=!1,t.sidebar.withoutAnimation=e},TOGGLE_DEVICE:function(t,e){t.device=e},SET_LANGUAGE:function(t,e){t.language=e,S.a.set("language",e)},SET_SIZE:function(t,e){t.size=e,S.a.set("size",e)}},actions:{toggleSideBar:function(t){var e=t.commit;e("TOGGLE_SIDEBAR")},closeSideBar:function(t,e){var i=t.commit,a=e.withoutAnimation;i("CLOSE_SIDEBAR",a)},toggleDevice:function(t,e){var i=t.commit;i("TOGGLE_DEVICE",e)},setLanguage:function(t,e){var i=t.commit;i("SET_LANGUAGE",e)},setSize:function(t,e){var i=t.commit;i("SET_SIZE",e)}}},M=G,B=(i("498a"),{state:{user:"",status:"",code:"",token:I(),name:"",avatar:""},mutations:{SET_CODE:function(t,e){t.code=e},SET_TOKEN:function(t,e){t.token=e},SET_STATUS:function(t,e){t.status=e},SET_NAME:function(t,e){t.name=e},SET_AVATAR:function(t,e){t.avatar=e}},actions:{LoginByUsername:function(t,e){var i=t.commit,a=e.username.trim();return new Promise((function(t,n){ft(a,e.password).then((function(e){var a=e.data;i("SET_TOKEN",a.access_token),x(e.data.access_token),t()})).catch((function(t){n(t)}))}))},GetUserInfo:function(t){var e=t.commit,i=t.state;return new Promise((function(t,a){vt(i.token).then((function(i){i.data||a("Verification failed, please login again.");var n=i.data;e("SET_NAME",n.name),e("SET_AVATAR",n.avatar),t(i)})).catch((function(t){a(t)}))}))},SetNewAvatar:function(t,e){var i=t.commit,a=t.state;a.name==e[0]&&i("SET_AVATAR",e[1])},FedLogOut:function(t){var e=t.commit;return new Promise((function(t){e("SET_TOKEN",""),T(),t()}))}}}),J=B,Y={token:function(t){return t.user.token},avatar:function(t){return t.user.avatar},name:function(t){return t.user.name},sidebar:function(t){return t.app.sidebar},device:function(t){return t.app.device},visitedViews:function(t){return t.tagsView.visitedViews},cachedViews:function(t){return t.tagsView.cachedViews},size:function(t){return t.app.size}},q=Y,K=(i("a4d3"),i("e01a"),i("d28b"),i("4de4"),i("caad"),i("c975"),i("fb6a"),i("a434"),i("2532"),i("3835")),Z={state:{visitedViews:[],cachedViews:[]},mutations:{ADD_VISITED_VIEW:function(t,e){t.visitedViews.some((function(t){return t.path===e.path}))||t.visitedViews.push(Object.assign({},e,{title:e.meta.title||"no-name"}))},ADD_CACHED_VIEW:function(t,e){t.cachedViews.includes(e.name)||e.meta.noCache||t.cachedViews.push(e.name)},DEL_VISITED_VIEW:function(t,e){var i=!0,a=!1,n=void 0;try{for(var s,r=t.visitedViews.entries()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var c=Object(K["a"])(s.value,2),o=c[0],u=c[1];if(u.path===e.path){t.visitedViews.splice(o,1);break}}}catch(l){a=!0,n=l}finally{try{i||null==r.return||r.return()}finally{if(a)throw n}}},DEL_CACHED_VIEW:function(t,e){var i=!0,a=!1,n=void 0;try{for(var s,r=t.cachedViews[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var c=s.value;if(c===e.name){var o=t.cachedViews.indexOf(c);t.cachedViews.splice(o,1);break}}}catch(u){a=!0,n=u}finally{try{i||null==r.return||r.return()}finally{if(a)throw n}}},DEL_OTHERS_VISITED_VIEWS:function(t,e){t.visitedViews=t.visitedViews.filter((function(t){return t.meta.affix||t.path===e.path}))},DEL_OTHERS_CACHED_VIEWS:function(t,e){var i=!0,a=!1,n=void 0;try{for(var s,r=t.cachedViews[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var c=s.value;if(c===e.name){var o=t.cachedViews.indexOf(c);t.cachedViews=t.cachedViews.slice(o,o+1);break}}}catch(u){a=!0,n=u}finally{try{i||null==r.return||r.return()}finally{if(a)throw n}}},DEL_ALL_VISITED_VIEWS:function(t){var e=t.visitedViews.filter((function(t){return t.meta.affix}));t.visitedViews=e},DEL_ALL_CACHED_VIEWS:function(t){t.cachedViews=[]},UPDATE_VISITED_VIEW:function(t,e){var i=!0,a=!1,n=void 0;try{for(var s,r=t.visitedViews[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var c=s.value;if(c.path===e.path){c=Object.assign(c,e);break}}}catch(o){a=!0,n=o}finally{try{i||null==r.return||r.return()}finally{if(a)throw n}}}},actions:{addView:function(t,e){var i=t.dispatch;i("addVisitedView",e),i("addCachedView",e)},addVisitedView:function(t,e){var i=t.commit;i("ADD_VISITED_VIEW",e)},addCachedView:function(t,e){var i=t.commit;i("ADD_CACHED_VIEW",e)},delView:function(t,e){var i=t.dispatch,a=t.state;return new Promise((function(t){i("delVisitedView",e),i("delCachedView",e),t({visitedViews:Object(R["a"])(a.visitedViews),cachedViews:Object(R["a"])(a.cachedViews)})}))},delVisitedView:function(t,e){var i=t.commit,a=t.state;return new Promise((function(t){i("DEL_VISITED_VIEW",e),t(Object(R["a"])(a.visitedViews))}))},delCachedView:function(t,e){var i=t.commit,a=t.state;return new Promise((function(t){i("DEL_CACHED_VIEW",e),t(Object(R["a"])(a.cachedViews))}))},delOthersViews:function(t,e){var i=t.dispatch,a=t.state;return new Promise((function(t){i("delOthersVisitedViews",e),i("delOthersCachedViews",e),t({visitedViews:Object(R["a"])(a.visitedViews),cachedViews:Object(R["a"])(a.cachedViews)})}))},delOthersVisitedViews:function(t,e){var i=t.commit,a=t.state;return new Promise((function(t){i("DEL_OTHERS_VISITED_VIEWS",e),t(Object(R["a"])(a.visitedViews))}))},delOthersCachedViews:function(t,e){var i=t.commit,a=t.state;return new Promise((function(t){i("DEL_OTHERS_CACHED_VIEWS",e),t(Object(R["a"])(a.cachedViews))}))},delAllViews:function(t,e){var i=t.dispatch,a=t.state;return new Promise((function(t){i("delAllVisitedViews",e),i("delAllCachedViews",e),t({visitedViews:Object(R["a"])(a.visitedViews),cachedViews:Object(R["a"])(a.cachedViews)})}))},delAllVisitedViews:function(t){var e=t.commit,i=t.state;return new Promise((function(t){e("DEL_ALL_VISITED_VIEWS"),t(Object(R["a"])(i.visitedViews))}))},delAllCachedViews:function(t){var e=t.commit,i=t.state;return new Promise((function(t){e("DEL_ALL_CACHED_VIEWS"),t(Object(R["a"])(i.cachedViews))}))},updateVisitedView:function(t,e){var i=t.commit;i("UPDATE_VISITED_VIEW",e)}}},Q=Z;n.a.use(U["a"]);var X=new U["a"].Store({modules:{app:M,user:J,tagsView:Q},getters:q}),tt=X,et=H.a.create({baseURL:Object({NODE_ENV:"production",BASE_URL:"/"}).BASE_API,timeout:5e3});et.interceptors.request.use((function(t){return tt.getters.token&&(t.headers["authorization"]="Bearer ".concat(I())),t}),(function(t){console.log(t),Promise.reject(t)})),et.interceptors.response.use((function(t){return t}),(function(t){return console.log("err"+t),Promise.reject(t)}));var it,at,nt,st,rt,ct,ot,ut,lt,dt=et,ft=function(t,e){var i={username:t,password:e};return dt({url:"/auth",method:"post",data:i})},vt=function(t){return dt({url:"/api/user/info",method:"get",params:{token:t}})},mt=function(t){return dt({url:"/api/status",method:"post",data:t})},pt=function(t){var e={url:t};return dt({url:"/api/get_url_info",method:"post",data:e})},ht=function(t){return dt({url:"/j/activities",method:"get",params:{page:t}})},bt=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a={reaction_type:i};return dt({url:"/j/activity/".concat(t,"/react"),headers:{"content-type":"application/x-www-form-urlencoded"},method:e,data:z.a.stringify(a)})},_t=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a={content:e,ref_id:i};return dt({url:"/j/activity/".concat(t,"/comment"),headers:{"content-type":"application/x-www-form-urlencoded"},method:"post",data:z.a.stringify(a)})},gt=function(t){return dt({url:"/j/activity/".concat(t,"/comments"),method:"get"})},wt=(it=Object(j["a"])({components:{FileUpload:F.a}}),it((nt=function(t){function e(){var t,i;Object(b["a"])(this,e);for(var a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return i=Object(g["a"])(this,(t=Object(w["a"])(e)).call.apply(t,[this].concat(n))),Object(O["a"])(Object(y["a"])(i),"text",""),Object(O["a"])(Object(y["a"])(i),"url",""),Object(O["a"])(Object(y["a"])(i),"urlInfo",null),Object(O["a"])(Object(y["a"])(i),"urlLoading",!1),Object(O["a"])(Object(y["a"])(i),"urlError",""),Object(O["a"])(Object(y["a"])(i),"activeLi",1),Object(O["a"])(Object(y["a"])(i),"files",[]),Object(O["a"])(Object(y["a"])(i),"fids",new Map),Object(O["a"])(Object(y["a"])(i),"OnFocus",!1),Object(O["a"])(Object(y["a"])(i),"name","file"),Object(O["a"])(Object(y["a"])(i),"changeTracker",1),i}return Object(C["a"])(e,t),Object(_["a"])(e,[{key:"getLinkInfo",value:function(){var t=this;if(!this.url.startsWith("http"))return this.urlError="这不是一个网址",!1;this.urlLoading=!0,pt(this.url).then((function(e){1==e.data.r?t.urlError=e.data.msg:t.urlInfo=e.data.info,t.urlLoading=!1})).catch((function(){t.urlError="超时了，请重试",t.urlLoading=!1}))}},{key:"customAction",value:function(t,e){var i,a;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(e.uploadHtml5(t));case 2:return i=n.sent,a=JSON.parse(i.xhr.responseText)["filename"],this.fids.set(t.id,a),this.changeTracker++,n.abrupt("return",i);case 7:case"end":return n.stop()}}),null,this)}},{key:"reset",value:function(){this.files=[],this.fids=new Map,this.url="",this.urlInfo=null}},{key:"activate",value:function(t){this.activeLi=t,1==this.activeLi&&1!=t||this.reset()}},{key:"onSubmit",value:function(){var t=this,e=Object(R["a"])(this.fids.values()),i={text:this.text,url:this.url,fids:e};this.url&&(i["url_info"]=this.urlInfo),mt(i).then((function(e){1==e.data.r?t.$toasted.show("发布失败: ".concat(e.data.msg)):(t.text="",t.url="",t.$toasted.show("已发布"),t.$emit("insertNewActivity",e.data.activity),t.reset())})).catch((function(){t.$toasted.show("发布失败")}))}},{key:"getCover",value:function(t){return this.changeTracker&&"/static/upload/"+(this.fids.get(t.id)||"").replace(".mp4",".png")}},{key:"removeFile",value:function(t){this.$refs.upload.remove(t),this.fids.delete(t.id)}},{key:"inputFilter",value:function(t,e,i){if(t&&!e){if(!/\.(jepg?|png?|mp4?|gif?|jpg?)$/i.test(t.name))return this.$toasted.show("不支持的文件类型"),i();var a=t.type.substr(0,6);if(2==this.activeLi&&"image/"!=a)return this.$toasted.show("照片Tab下不能放视频"),i();if(3==this.activeLi&&"video/"!=a)return this.$toasted.show("视频Tab下不能放照片"),i()}if(t&&(t.active=!0),t&&(!e||t.file!==e.file)){t.blob="";var n=window.URL||window.webkitURL;n&&n.createObjectURL&&(t.blob=n.createObjectURL(t.file)),t.thumb="",t.blob&&"image/"===t.type.substr(0,6)&&(t.thumb=t.blob)}}},{key:"inputFile",value:function(t,e){if(t&&!e&&1==this.files.length){var i=t.type.substr(0,6);"image/"===i?this.activeLi=2:"video/"===i&&(this.activeLi=3)}if(t&&e){var a=t.xhr.responseText;if(a){var n=JSON.parse(a)["filename"];this.fids.set(t.id,n),this.changeTracker++}}}},{key:"textAreaHeight",get:function(){if(this.OnFocus||1!=this.activeLi){var t=this.text.split(/\r\n|\r|\n/).length+1;return t>5?16*t:80}return 32}},{key:"showIcon",get:function(){return 1==this.activeLi}}]),e}(n.a),at=nt))||at),yt=wt,Ct=(i("a2f7"),Object(l["a"])(yt,D,P,!1,null,"391672ee",null)),Ot=Ct.exports,Et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"paginator"},[i("span",{staticClass:"prev"},[1!=t.page?i("a",{attrs:{href:"?p="+(t.page-1)}},[t._v("<前页")]):i("span",[t._v("<前页")])]),t._l(t.pages,(function(e,a){return i("div",{key:a,staticClass:"paginator-item"},[t.page!=e?i("a",{attrs:{href:"?p="+e}},[t._v(t._s(e))]):i("span",{staticClass:"current"},[t._v(t._s(e))])])})),t.maxPage>5?i("span",{staticClass:"break"},[t._v("...")]):t._e(),i("span",{staticClass:"next"},[t.page!=t.maxPage?i("a",{attrs:{href:"?p="+(t.page+1)}},[t._v("后页>")]):i("span",[t._v("后页>")])])],2)},Vt=[],jt=(st=Object(j["a"])({props:{total:{default:10},page:{default:1}}}),st((ct=function(t){function e(){var t,i;Object(b["a"])(this,e);for(var a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return i=Object(g["a"])(this,(t=Object(w["a"])(e)).call.apply(t,[this].concat(n))),Object(O["a"])(Object(y["a"])(i),"perPage",10),i}return Object(C["a"])(e,t),Object(_["a"])(e,[{key:"maxPage",get:function(){return Math.ceil(this.total/this.perPage)}},{key:"pages",get:function(){return Object(R["a"])(Array(this.maxPage).keys()).map((function(t){return t+1}))}}]),e}(n.a),rt=ct))||rt),kt=jt,St=(i("a8eb"),Object(l["a"])(kt,Et,Vt,!1,null,"0384c9e0",null)),Lt=St.exports;V.a.locale("zh-cn");var At=(ot=Object(j["a"])({components:{UploadForm:Ot,Paginator:Lt}}),ot((lt=function(t){function e(){var t,i;Object(b["a"])(this,e);for(var a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return i=Object(g["a"])(this,(t=Object(w["a"])(e)).call.apply(t,[this].concat(n))),Object(O["a"])(Object(y["a"])(i),"page",1),Object(O["a"])(Object(y["a"])(i),"total",10),Object(O["a"])(Object(y["a"])(i),"listLoading",!1),Object(O["a"])(Object(y["a"])(i),"activities",[]),Object(O["a"])(Object(y["a"])(i),"refId",0),Object(O["a"])(Object(y["a"])(i),"replyTo",""),Object(O["a"])(Object(y["a"])(i),"commentContent",""),i}return Object(C["a"])(e,t),Object(_["a"])(e,[{key:"patchActivity",value:function(t){return t.big=!1,t.showReply=!1,t.showComments=!1,t.commentFetched=!1,t.comments=[],t}},{key:"getActivityList",value:function(){var t=this;this.listLoading=!0,this.page=this.$route.query.p||this.page,ht(this.page).then((function(e){t.activities=e.data.items.map((function(e){return t.patchActivity(e)})),t.total=e.data.total,t.listLoading=!1}))}},{key:"insertNewActivity",value:function(t){this.activities.unshift(this.patchActivity(t))}},{key:"moment",value:function(t){return V()(1e3*t)}},{key:"created",value:function(){return this.getActivityList()}},{key:"toggleActivitySize",value:function(t){2==t.layout&&t.big||(t.big=!t.big)}},{key:"fetchCommentList",value:function(t){gt(t.id).then((function(e){t.comments=e.data.items.map((function(t){return t.showReply=!1,t})),t.commentFetched=!0}))}},{key:"toggleShowComments",value:function(t){t.showComments=!t.showComments,t.showComments&&t.commentFetched||t.showComments&&this.fetchCommentList(t)}},{key:"react",value:function(t){var e=this;bt(t.id,t.liked?"delete":"post").then((function(i){0!=i.data.r?(e.$toasted.show("点赞失败: ".concat(i.data.msg)),403==i.data.r&&(e.$toasted.show("登录中..."),window.location="/oauth/activities")):(t.n_likes=i.data.n_reacted,t.liked=!t.liked)}))}},{key:"commentTo",value:function(t){var e=this;this.commentContent&&_t(t.id,"".concat(this.replyTo," ").concat(this.commentContent),this.refId).then((function(i){if(0!=i.data.r)e.$toasted.show("评论失败: ".concat(i.data.msg)),403==i.data.r&&(e.$toasted.show("登录中..."),window.location="/oauth/activities");else{e.$toasted.show("评论成功"),e.replyTo="",e.commentContent="";var a=i.data.comment;a.showReply=!1,t.comments.unshift(a)}}))}},{key:"reply",value:function(t,e){this.refId=e.id,this.replyTo="回应 @".concat(e.user.username)}},{key:"token",get:function(){return I()}}]),e}(n.a),ut=lt))||ut),It=At,xt=(i("d4eb"),Object(l["a"])(It,p,h,!1,null,"3e5fbf58",null)),Tt=xt.exports;n.a.use(m["a"]);var Dt=[{path:"/",name:"main",component:Tt}],Pt=new m["a"]({mode:"history",base:"/activities",routes:Dt}),Rt=Pt;n.a.use(U["a"]);var $t=new U["a"].Store({state:{},mutations:{},actions:{},modules:{}});i("a562"),i("4c20"),i("9ae0");n.a.config.productionTip=!1,n.a.use(r.a,{duration:3e3}),n.a.use(c["a"],{plyr:{captions:{defaultActive:!1},controls:["play","progress","current-time","duration","mute","volume","fullscreen"]}}),new n.a({router:Rt,store:$t,render:function(t){return t(v)}}).$mount("#app")},"6aca":function(t,e,i){},7061:function(t,e,i){},"85ec":function(t,e,i){},"8bbf":function(t,e){t.exports=Vue},"9ae0":function(t,e,i){},a2f7:function(t,e,i){"use strict";var a=i("7061"),n=i.n(a);n.a},a562:function(t,e,i){},a8eb:function(t,e,i){"use strict";var a=i("3e42"),n=i.n(a);n.a},c32d:function(t,e){t.exports=moment},d4eb:function(t,e,i){"use strict";var a=i("6aca"),n=i.n(a);n.a}});